import{c as O,r as l,j as e,B as b,h as R,i as G,a as W,s as F,V as P,O as X}from"./index-BQ92t-xb.js";import{C as $}from"./Card-Cr9OAgbB.js";import{I as T}from"./Input-BZEgl9G2.js";import{S as z}from"./Select-BwRdW-mQ.js";import{F as H}from"./funnel-BJnlsVnC.js";import{S as J}from"./search-CZ-s9-55.js";import{S as q}from"./square-pen-BIVQ8kyS.js";import{T as I}from"./trash-2-DiA01aMl.js";import K from"./tag-CzMNOLPg.js";import Q from"./credit-card-BKVcKJ_8.js";import{C as Y}from"./calendar-DHK5Xtal.js";import{F as Z}from"./file-x-C7hgEAyV.js";import{M as ee}from"./Modal-BfbFXPiL.js";import{T as te}from"./TextArea-Cp0WOQfX.js";import{l as ae}from"./activityLogger-D5lQN0Gb.js";import{C as se}from"./ConfirmationModal-CFQUW-DD.js";import{P as re}from"./plus-De4zK4eV.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]],ne=O("arrow-down-wide-narrow",le);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]],de=O("arrow-up-narrow-wide",ie),oe=({expenses:x,loading:C,onEdit:M,onDelete:n})=>{const[c,s]=l.useState(""),[p,i]=l.useState(""),[u,v]=l.useState(""),[r,h]=l.useState("date"),[g,_]=l.useState("desc"),[y,f]=l.useState(1),j=10,{categories:w,paymentMethods:a}=l.useMemo(()=>{const t=[...new Set(x.map(o=>o.expense_type))].sort(),m=[...new Set(x.map(o=>o.payment_method))].sort();return{categories:t.map(o=>({value:o,label:o})),paymentMethods:m.map(o=>({value:o,label:o}))}},[x]),d=l.useMemo(()=>{let t=x;if(c){const m=c.toLowerCase();t=t.filter(o=>o.expense_type.toLowerCase().includes(m)||o.paid_to.toLowerCase().includes(m)||o.notes&&o.notes.toLowerCase().includes(m))}return p&&(t=t.filter(m=>m.expense_type===p)),u&&(t=t.filter(m=>m.payment_method===u)),t.sort((m,o)=>{let k=m[r],S=o[r];return r==="date"?(k=new Date(k).getTime(),S=new Date(S).getTime()):r==="amount"?(k=Number(k),S=Number(S)):(k=String(k).toLowerCase(),S=String(S).toLowerCase()),g==="asc"?k>S?1:-1:k<S?1:-1}),t},[x,c,p,u,r,g]),N=Math.ceil(d.length/j),E=d.slice((y-1)*j,y*j),B=t=>{r===t?_(g==="asc"?"desc":"asc"):(h(t),_("desc")),f(1)},A=()=>{s(""),i(""),v(""),h("date"),_("desc"),f(1)},D=({field:t,children:m})=>e.jsxs("button",{onClick:()=>B(t),className:"flex items-center gap-1 hover:text-primary-600 transition-colors",children:[m,r===t&&(g==="asc"?e.jsx(de,{size:14}):e.jsx(ne,{size:14}))]}),U=()=>e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((t,m)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/5"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/8"})]},m))})}),L=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(Z,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No expenses found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-sm",children:c||p||u?"No expenses match your current filters.":"Get started by adding your first expense."}),(c||p||u)&&e.jsx(b,{variant:"outline",size:"sm",onClick:A,className:"mt-3",children:"Clear Filters"})]}),V=()=>N<=1?null:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",(y-1)*j+1," to ",Math.min(y*j,d.length)," of ",d.length," expenses"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>f(t=>Math.max(1,t-1)),disabled:y===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",y," of ",N]}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>f(t=>Math.min(N,t+1)),disabled:y===N,children:"Next"})]})]});return e.jsxs($,{children:[e.jsxs("div",{className:"p-4 border-b dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Expense Records"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(H,{size:16}),d.length," of ",x.length," expenses"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2"}),e.jsx(T,{id:"search-expenses",placeholder:"Search expenses...",value:c,onChange:t=>{s(t.target.value),f(1)},className:"pl-10"})]}),e.jsx(z,{id:"category-filter",label:"",options:w,value:p,onChange:t=>{i(t.target.value),f(1)},placeholder:"All Categories"}),e.jsx(z,{id:"payment-method-filter",label:"",options:a,value:u,onChange:t=>{v(t.target.value),f(1)},placeholder:"All Payment Methods"}),e.jsx(b,{variant:"outline",onClick:A,className:"w-full",children:"Clear Filters"})]})]}),C?e.jsx(U,{}):e.jsxs("div",{children:[e.jsx("div",{className:"md:hidden p-4 space-y-3",children:E.length>0?E.map(t=>e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border dark:border-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-bold text-gray-800 dark:text-white",children:t.paid_to}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{variant:"icon",size:"sm",onClick:()=>M(t),title:"Edit",children:e.jsx(q,{size:16})}),e.jsx(b,{variant:"icon",size:"sm",onClick:()=>n(t),title:"Delete",children:e.jsx(I,{size:16,className:"text-red-500"})})]})]}),e.jsxs("p",{className:"font-bold text-lg text-red-500 dark:text-red-400 mb-2",children:["â‚¹",t.amount.toLocaleString("en-IN")]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(K,{size:14})," ",t.expense_type]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Q,{size:14})," ",t.payment_method]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:14})," ",new Date(t.date).toLocaleDateString("en-GB")]}),t.notes&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 text-sm",children:t.notes})]})]},t.id)):e.jsx(L,{})}),e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsx(D,{field:"date",children:"Date"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsx(D,{field:"paid_to",children:"Paid To"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:e.jsx(D,{field:"expense_type",children:"Category"})}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-700 dark:text-gray-300",children:e.jsx(D,{field:"amount",children:"Amount"})}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Payment Method"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700 dark:text-gray-300",children:"Notes"}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-700 dark:text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:E.length>0?E.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900 dark:text-white",children:t.paid_to}),e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-600 rounded-full text-xs",children:t.expense_type})}),e.jsxs("td",{className:"px-4 py-3 font-bold text-red-500 dark:text-red-400 text-right",children:["â‚¹",t.amount.toLocaleString("en-IN")]}),e.jsx("td",{className:"px-4 py-3 text-gray-700 dark:text-gray-300",children:t.payment_method}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-400 max-w-xs",children:t.notes?e.jsx("span",{className:"truncate block\\",title:t.notes,children:t.notes}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>M(t),title:"Edit expense",children:e.jsx(q,{size:14})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>n(t),title:"Delete expense",children:e.jsx(I,{size:14})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:e.jsx(L,{})})})})]})}),e.jsx(V,{})]})]})},ce=({isOpen:x,onClose:C,onSave:M,editingExpense:n})=>{const{userProfile:c}=R(),[s,p]=l.useState({date:new Date().toISOString().split("T")[0],expense_type:"",paid_to:"",amount:"",payment_method:"Cash",notes:""}),[i,u]=l.useState(!1),[v,r]=l.useState(null);l.useEffect(()=>{x&&(p(n?{date:n.date,expense_type:n.expense_type,paid_to:n.paid_to,amount:String(n.amount),payment_method:n.payment_method,notes:n.notes||""}:{date:new Date().toISOString().split("T")[0],expense_type:"",paid_to:"",amount:"",payment_method:"Cash",notes:""}),r(null))},[x,n]);const h=j=>{const{id:w,value:a}=j.target;p({...s,[w]:a}),v&&r(null)},g=()=>s.date?s.expense_type?s.paid_to.trim()?!s.amount||parseFloat(s.amount)<=0?"Amount must be greater than zero":s.payment_method?null:"Payment method is required":"Paid to field is required":"Expense type is required":"Date is required",_=async j=>{j.preventDefault(),r(null);const w=g();if(w){r(w);return}u(!0);try{const a={date:s.date,expense_type:s.expense_type,paid_to:s.paid_to.trim(),amount:parseFloat(s.amount),payment_method:s.payment_method,notes:s.notes.trim()||void 0};await M(a);const d=(c==null?void 0:c.name)||"Admin",N=n?`Updated an expense of â‚¹${a.amount.toLocaleString("en-IN")} for "${a.expense_type}"`:`Added a new expense: â‚¹${a.amount.toLocaleString("en-IN")} for "${a.expense_type}" paid to ${a.paid_to}`;await ae(N,d),C()}catch(a){r(a.message||"Failed to save expense")}finally{u(!1)}},y=[{value:"Rent",label:"Rent"},{value:"Utilities",label:"Utilities"},{value:"Materials",label:"Materials"},{value:"Equipment",label:"Equipment"},{value:"Maintenance",label:"Maintenance"},{value:"Salaries",label:"Salaries"},{value:"Transportation",label:"Transportation"},{value:"Marketing",label:"Marketing"},{value:"Office Supplies",label:"Office Supplies"},{value:"Miscellaneous",label:"Miscellaneous"}],f=[{value:"Cash",label:"Cash"},{value:"Credit Card",label:"Credit Card"},{value:"Debit Card",label:"Debit Card"},{value:"Bank Transfer",label:"Bank Transfer"},{value:"UPI",label:"UPI"},{value:"Check",label:"Check"}];return e.jsx(ee,{isOpen:x,onClose:C,title:n?"Edit Expense":"Add New Expense",size:"lg",children:e.jsxs("form",{onSubmit:_,className:"space-y-4 pt-2",children:[v&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 text-red-700 border border-red-200 rounded-md text-sm",children:[e.jsx(G,{size:18}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(T,{id:"date",label:"Date *",type:"date",value:s.date,onChange:h,required:!0,disabled:i}),e.jsx(z,{id:"expense_type",label:"Expense Type *",options:y,value:s.expense_type,onChange:h,required:!0,disabled:i,placeholder:"Select expense type"})]}),e.jsx(T,{id:"paid_to",label:"Paid To *",value:s.paid_to,onChange:h,required:!0,disabled:i,placeholder:"e.g., TNEB, Vendor Name, Employee Name"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(T,{id:"amount",label:"Amount (â‚¹) *",type:"number",step:"0.01",min:"0.01",value:s.amount,onChange:h,required:!0,disabled:i,placeholder:"e.g., 5000"}),e.jsx(z,{id:"payment_method",label:"Payment Method *",options:f,value:s.payment_method,onChange:h,required:!0,disabled:i})]}),e.jsx(te,{id:"notes",label:"Notes (Optional)",value:s.notes,onChange:h,disabled:i,placeholder:"Any additional details about this expense...",rows:3}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(b,{type:"button",variant:"outline",onClick:C,disabled:i,children:"Cancel"}),e.jsx(b,{type:"submit",variant:"primary",disabled:i,children:i?e.jsx(W,{className:"w-5 h-5 animate-spin"}):n?"Update Expense":"Save Expense"})]})]})})},Me=()=>{const[x,C]=l.useState([]),[M,n]=l.useState(!0),[c,s]=l.useState(null),[p,i]=l.useState(!1),[u,v]=l.useState(!1),[r,h]=l.useState(null),g=l.useCallback(async()=>{n(!0);try{const{data:a,error:d}=await F.from("expenses").select("*").order("date",{ascending:!1});if(d)throw d;C(a||[])}catch(a){P.error(a.message||"Failed to fetch expenses.")}finally{n(!1)}},[]);l.useEffect(()=>{g()},[g]);const _=async a=>{const d=c?F.from("expenses").update(a).eq("id",c.id):F.from("expenses").insert([a]);await P.promise(d,{loading:"Saving expense...",success:`Expense ${c?"updated":"added"} successfully!`,error:E=>E.message||"Failed to save expense."});const{error:N}=await d;N||(i(!1),s(null),g())},y=a=>{s(a),i(!0)},f=a=>{h(a),v(!0)},j=async()=>{if(!r)return;const a=F.from("expenses").delete().eq("id",r.id);await P.promise(a,{loading:"Deleting expense...",success:"Expense deleted successfully.",error:N=>N.message||"Failed to delete expense."});const{error:d}=await a;d||g(),v(!1),h(null)},w=l.useMemo(()=>x.reduce((a,d)=>a+d.amount,0),[x]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsx(X,{position:"top-right"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"ðŸ’¸ Expenses"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Track and manage all your expenses."})]}),e.jsxs(b,{onClick:()=>{s(null),i(!0)},className:"w-full sm:w-auto",children:[e.jsx(re,{className:"w-4 h-4 mr-2"})," Add Expense"]})]}),e.jsx($,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Expenses Logged"}),e.jsxs("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:["â‚¹",w.toLocaleString("en-IN")]})]})}),e.jsx(oe,{expenses:x,loading:M,onEdit:y,onDelete:f}),e.jsx(ce,{isOpen:p,onClose:()=>i(!1),onSave:_,editingExpense:c}),e.jsx(se,{isOpen:u,onClose:()=>v(!1),onConfirm:j,title:"Confirm Deletion",description:`Are you sure you want to delete this expense? (${r==null?void 0:r.expense_type} - â‚¹${r==null?void 0:r.amount})`,confirmText:"Delete"})]})};export{Me as default};
