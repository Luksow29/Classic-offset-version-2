import{c as j,j as e,L as f,r as c,B as N,U as b,P as k,a as w,T as v,s as D}from"./index-BQ92t-xb.js";import{C as m}from"./Card-Cr9OAgbB.js";import{H as _}from"./hash-CvZM-WGw.js";import{l as O}from"./index-DdHjBg5j.js";import{P as S}from"./printer-CF5_TQA7.js";import C from"./banknote-BJPN380d.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]],E=j("party-popper",P),L=({deliveryDate:r})=>{const d=new Date,o=new Date(r),t=Math.ceil((o.getTime()-d.getTime())/(1e3*60*60*24));let l="bg-green-200 text-green-800",i="Upcoming";return t<0?(l="bg-red-200 text-red-800",i="Overdue"):t<=3&&(l="bg-yellow-200 text-yellow-800",i="Due Soon"),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${l}`,children:i})},M=({customer:r,orders:d})=>{const o=d.reduce((t,l)=>t+(l.balance_due||0),0);return e.jsx(m,{children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-white",children:r}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Due"}),e.jsxs("span",{className:"text-lg sm:text-xl font-bold text-red-600 dark:text-red-400",children:["₹",o.toLocaleString("en-IN")]})]})]}),e.jsx("ul",{className:"mt-3 space-y-2 border-t border-gray-200 dark:border-gray-700 pt-3",children:d.map(t=>e.jsxs("li",{className:"flex justify-between items-center text-sm p-2 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsxs(f,{to:`/invoices/${t.order_id}`,className:"flex items-center gap-2 text-primary-600 hover:underline",children:[e.jsx(_,{size:14}),e.jsxs("span",{children:["Order #",t.order_id]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-gray-700 dark:text-gray-200",children:["₹",t.balance_due.toLocaleString("en-IN")]}),e.jsx(L,{deliveryDate:t.date})]})]},t.order_id))})]})})},H=()=>{const[r,d]=c.useState([]),[o,t]=c.useState(!0),[l,i]=c.useState(null),h=c.useRef(null),p=O.useReactToPrint({content:()=>h.current,documentTitle:"Due Summary Report",pageStyle:"@media print { body { -webkit-print-color-adjust: exact; } .no-print { display: none; } }"});c.useEffect(()=>{(async()=>{t(!0),i(null);try{const{data:s,error:n}=await D.from("order_summary_with_dues").select("*").gt("balance_due",0).order("customer_name",{ascending:!0});if(n)throw n;d(s||[])}catch(s){console.error("❌ Error fetching due orders:",s),i(`Failed to load due summary. ${s.message}`)}finally{t(!1)}})()},[]);const u=c.useMemo(()=>{const a={};return r.forEach(s=>{const n=s.customer_name||"Unknown Customer";a[n]||(a[n]=[]),a[n].push(s)}),a},[r]),x=c.useMemo(()=>{const a=r.reduce((g,y)=>g+(y.balance_due||0),0),s=r.length,n=Object.keys(u).length;return{totalDueOverall:a,totalPendingOrders:s,totalCustomersWithDues:n}},[r,u]);return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 animate-slide-up",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-800 dark:text-white",children:" Due Summary"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pending payments grouped by customer."})]}),e.jsx("div",{className:"no-print",children:e.jsxs(N,{onClick:p,children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Export Due Summary"]})})]}),e.jsxs("div",{ref:h,className:"space-y-6",children:[!o&&r.length>0&&e.jsx(m,{children:e.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center p-2",children:[e.jsx(C,{className:"w-6 h-6 mb-1 text-red-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Total Due"}),e.jsxs("span",{className:"text-lg font-bold text-gray-800 dark:text-white",children:["₹",x.totalDueOverall.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex flex-col items-center p-2",children:[e.jsx(b,{className:"w-6 h-6 mb-1 text-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Customers with Dues"}),e.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-white",children:x.totalCustomersWithDues})]}),e.jsxs("div",{className:"flex flex-col items-center p-2",children:[e.jsx(k,{className:"w-6 h-6 mb-1 text-yellow-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Pending Orders"}),e.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-white",children:x.totalPendingOrders})]})]})}),o?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(w,{className:"w-8 h-8 animate-spin text-primary-500"}),e.jsx("p",{className:"ml-3 text-gray-500 dark:text-gray-400",children:"Loading due summary..."})]}):l?e.jsxs(m,{className:"p-6 bg-red-50 text-red-700 border border-red-300 text-center",children:[e.jsx(v,{className:"w-10 h-10 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{className:"text-sm",children:l})]}):x.totalCustomersWithDues===0?e.jsxs(m,{className:"p-12 text-center bg-green-50 dark:bg-green-900/30",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-3 text-green-500"}),e.jsx("p",{className:"font-semibold text-lg text-green-700 dark:text-green-200",children:"No Dues!"}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-300",children:"All payments are up to date."})]}):Object.entries(u).map(([a,s])=>e.jsx(M,{customer:a,orders:s},a))]})]})};export{H as default};
