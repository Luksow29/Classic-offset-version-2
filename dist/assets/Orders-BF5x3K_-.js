import{c as te,r,j as e,s as N,h as Oe,B as j,D as qe,a as Y,V as P,I as Le,b as Be,d as Ue,e as Re,f as Ve,P as ce,T as Pe,g as Qe,R as He,X as Ye,L as Se,l as Ge,N as We}from"./index-BQ92t-xb.js";import{C as $}from"./Card-Cr9OAgbB.js";import{I as A}from"./Input-BZEgl9G2.js";import{S as B}from"./Select-BwRdW-mQ.js";import{T as Ie}from"./TextArea-Cp0WOQfX.js";import{l as Ae}from"./activityLogger-D5lQN0Gb.js";import{C as Xe}from"./CustomerFormModal-B1qZrkVi.js";import ee from"./user-CIFL-UWv.js";import{C as Ze}from"./circle-plus-uaTjFC1H.js";import{C as Z}from"./calendar-DHK5Xtal.js";import Je from"./shopping-bag-BrkeNu9j.js";import{P as $e}from"./palette-CeCNDCCv.js";import{C as Ke}from"./check-B2F4x3B2.js";import ge from"./truck-C58qqGGm.js";import{P as he}from"./printer-CF5_TQA7.js";import{M as J}from"./Modal-BfbFXPiL.js";import pe from"./check-circle-CTtHyn7T.js";import ze from"./phone-BhdOTX_m.js";import es from"./map-pin-CHQvbAUO.js";import me from"./clock-CiZ1IF_T.js";import{T as se}from"./trash-2-DiA01aMl.js";import{S as ue}from"./square-pen-BIVQ8kyS.js";import{D as ss}from"./download-B9ew1_ti.js";import{S as ts}from"./search-CZ-s9-55.js";import{E as Ce}from"./eye-B7MUet3E.js";import{F as De}from"./file-x-C7hgEAyV.js";import{A as as}from"./arrow-up-down-BPCEvZx4.js";import{L as rs}from"./list-CdTLXTIM.js";import{P as ds}from"./plus-De4zK4eV.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],ls=te("archive",is);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],os=te("ellipsis",ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ae=te("pencil",cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]],us=te("sticky-note",ms),xs=({onSelect:l,selectedId:n,label:d="Customer",className:i})=>{const[a,b]=r.useState([]),[h,_]=r.useState(!0);r.useEffect(()=>{(async()=>{_(!0);const{data:s,error:o}=await N.from("customers").select("id, name, phone").order("name",{ascending:!0});o?console.error("❌ Failed to fetch customers:",o.message):b(s||[]),_(!1)})()},[]);const c=u=>{const s=u.target.value,o=a.find(p=>p.id===s);l(o?{id:o.id,phone:o.phone,name:o.name}:null)},v=a.map(u=>({value:u.id,label:u.name}));return e.jsx(B,{id:"customer-select",label:d,value:n||"",onChange:c,options:v,placeholder:"-- Select a Customer --",disabled:h,className:i})},gs=({onSuccess:l})=>{const{user:n,userProfile:d}=Oe(),[i,a]=r.useState([]),[b,h]=r.useState([]),[_,c]=r.useState([]),[v,u]=r.useState([]),[s,o]=r.useState({date:new Date().toISOString().split("T")[0],customerId:"",customerName:"",orderType:"",productId:"",quantity:"1",rate:"0",totalAmount:"0",amountReceived:"0",designNeeded:"No",designerId:"",deliveryDate:"",paymentMethod:"Cash",notes:""}),[p,F]=r.useState(!1),[x,m]=r.useState(null),[z,E]=r.useState(!1),[M,V]=r.useState(0);r.useEffect(()=>{(async()=>{const{data:f,error:q}=await N.from("products").select("id, name, unit_price, category");if(f){a(f),h(f);const X=[...new Set(f.map(L=>L.category))];u(X.map(L=>({value:L,label:L})))}const{data:D}=await N.from("employees").select("id, name, job_role").eq("job_role","Designer").eq("is_active",!0);c(D||[])})()},[]),r.useEffect(()=>{const y=parseInt(s.quantity||"0"),f=parseFloat(s.rate||"0");o(q=>({...q,totalAmount:(y*f).toFixed(2)}))},[s.quantity,s.rate]),r.useEffect(()=>{h(s.orderType?i.filter(y=>y.category===s.orderType):i),o(y=>({...y,productId:"",rate:"0"}))},[s.orderType,i]);const C=y=>{const{id:f,value:q}=y.target,D={...s,[f]:q};if(f==="productId"&&q){const X=i.find(L=>L.id===parseInt(q));X&&(D.rate=String(X.unit_price))}o(D)},Q=y=>{o(y?f=>({...f,customerId:y.id,customerName:y.name}):f=>({...f,customerId:"",customerName:""}))},re=y=>{V(f=>f+1),Q(y),E(!1)},G=async y=>{if(y.preventDefault(),!n||!s.customerId){m("A customer must be selected.");return}if(!s.deliveryDate){m("Delivery date is required.");return}if(!s.orderType||!s.productId){m("Order type and product are required.");return}F(!0),m(null);try{const f={date:s.date,customer_id:s.customerId,customer_name:s.customerName,order_type:s.orderType,product_id:parseInt(s.productId),quantity:parseInt(s.quantity),rate:parseFloat(s.rate),total_amount:parseFloat(s.totalAmount),amount_received:parseFloat(s.amountReceived)||0,balance_amount:parseFloat(s.totalAmount)-(parseFloat(s.amountReceived)||0),payment_method:s.amountReceived!=="0"&&parseFloat(s.amountReceived)>0?s.paymentMethod:null,design_needed:s.designNeeded==="Yes",designer_id:s.designNeeded==="Yes"?s.designerId:null,delivery_date:s.deliveryDate,notes:s.notes,user_id:n.id},{data:q,error:D}=await N.from("orders").insert(f).select().single();if(D)throw D;if(!q)throw new Error("Failed to create order, no data returned.");P.success(`Order #${q.id} created successfully!`),await Ae(`Created new order #${q.id} for ${s.customerName}`,d==null?void 0:d.name),parseFloat(s.amountReceived)>0&&await N.from("payments").insert({order_id:q.id,customer_id:s.customerId,amount_paid:parseFloat(s.amountReceived),payment_date:s.date,payment_method:s.paymentMethod,notes:"Initial payment with order.",created_by:n.id}),l()}catch(f){P.error(f.message||"Failed to create order."),m(f.message)}finally{F(!1)}},de=[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],W=[{value:"Cash",label:"Cash"},{value:"UPI",label:"UPI"},{value:"Bank Transfer",label:"Bank Transfer"}];return e.jsxs(e.Fragment,{children:[e.jsx(Xe,{isOpen:z,onClose:()=>E(!1),onSuccess:re}),e.jsxs("form",{onSubmit:G,className:"space-y-8",children:[x&&e.jsx("div",{className:"text-red-700 p-3 bg-red-50 dark:bg-red-900/20 rounded-md text-sm border border-red-200 dark:border-red-800",children:x}),e.jsxs($,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-200",children:"Customer Information"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(xs,{onSelect:Q,selectedId:s.customerId,className:"flex-grow"},M),e.jsx(j,{type:"button",variant:"outline",onClick:()=>E(!0),className:"p-2 aspect-square h-10 flex-shrink-0",title:"Add New Customer",children:e.jsx(Ze,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{icon:e.jsx(Z,{size:16,className:"text-gray-400"}),id:"date",label:"Order Date *",type:"date",value:s.date,onChange:C,required:!0}),e.jsx(A,{icon:e.jsx(Z,{size:16,className:"text-gray-400"}),id:"deliveryDate",label:"Delivery Date *",type:"date",value:s.deliveryDate,onChange:C,required:!0})]})]})]}),e.jsxs($,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx(Je,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-200",children:"Order Details"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(B,{id:"orderType",label:"Order Type *",options:v,value:s.orderType,onChange:C,required:!0,placeholder:"Select Order Type"}),e.jsx(B,{id:"productId",label:"Product *",options:b.map(y=>({value:y.id,label:y.name})),value:s.productId,onChange:C,required:!0,disabled:!i.length,placeholder:"Select Product"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(A,{id:"quantity",label:"Quantity *",type:"number",min:"1",value:s.quantity,onChange:C,required:!0}),e.jsx(A,{id:"rate",label:"Rate (₹) *",type:"number",value:s.rate,onChange:C,required:!0}),e.jsx(A,{id:"totalAmount",label:"Total (₹)",type:"number",value:s.totalAmount,readOnly:!0,className:"bg-gray-100 dark:bg-gray-700"})]})]})]}),e.jsxs($,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx($e,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-200",children:"Design Details"})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(B,{id:"designNeeded",label:"Design Needed?",options:de,value:s.designNeeded,onChange:C}),s.designNeeded==="Yes"&&e.jsx(B,{id:"designerId",label:"Assign Designer",options:_.map(y=>({value:y.id,label:y.name})),value:s.designerId,onChange:C,required:!0,placeholder:"Select Designer"})]})]}),e.jsxs($,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-200",children:"Initial Payment"})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{id:"amountReceived",label:"Amount Received (₹)",type:"number",value:s.amountReceived,onChange:C,placeholder:"Enter advance amount"}),e.jsx(B,{id:"paymentMethod",label:"Payment Method",options:W,value:s.paymentMethod,onChange:C,disabled:!s.amountReceived||s.amountReceived==="0"})]})]}),e.jsxs($,{className:"p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 border-b dark:border-gray-700 flex items-center gap-3",children:[e.jsx(us,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-gray-200",children:"Additional Notes"})]}),e.jsx("div",{className:"p-6",children:e.jsx(Ie,{id:"notes",label:"Notes",value:s.notes,onChange:C,placeholder:"Any special instructions or details about the order..."})})]}),e.jsx("div",{className:"pt-4",children:e.jsx(j,{type:"submit",size:"lg",className:"w-full",disabled:p,children:p?e.jsx(Y,{className:"animate-spin mx-auto"}):"Save Order"})})]})]})},oe=["Pending","Design","Printing","Delivered"],hs={Pending:ae,Design:he,Printing:ge,Delivered:Ke},xe=({currentStatus:l})=>{const n=oe.indexOf(l);return e.jsx("div",{className:"flex items-center w-full","aria-label":"Order Status",children:oe.map((d,i)=>{const a=i<n,b=i===n,h=hs[d];return e.jsxs(Le.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center text-center w-1/4",children:[e.jsx("div",{className:`
                w-10 h-10 flex items-center justify-center rounded-full border-2 transition-all duration-300 transform
                ${a?"bg-green-500 border-green-500 text-white":b?"bg-primary border-primary text-primary-foreground scale-110 shadow-lg":"bg-gray-100 border-gray-300 text-gray-400 dark:bg-gray-700 dark:border-gray-600"}`,children:e.jsx(h,{size:a?20:18})}),e.jsx("p",{className:`mt-2 text-xs font-medium transition-colors ${b?"text-primary":"text-gray-500 dark:text-gray-400"}`,children:d})]}),i<oe.length-1&&e.jsx("div",{className:`flex-1 h-1 transition-colors duration-500 mx-1 ${i<n?"bg-green-400":"bg-gray-200 dark:bg-gray-600"}`})]},d)})})},ps=[{name:"Pending",icon:ae},{name:"Design",icon:he},{name:"Printing",icon:ge},{name:"Delivered",icon:pe}],ys=({order:l,isOpen:n,onClose:d,onStatusUpdated:i})=>{const[a,b]=r.useState(l.status),[h,_]=r.useState(!1),{userProfile:c}=Oe(),v=async()=>{_(!0);const u=(c==null?void 0:c.name)||"Admin",{error:s}=await N.from("order_status_log").insert({order_id:l.order_id,status:a,updated_by:u});if(s){P.error(`Failed to update status: ${s.message}`),_(!1);return}P.success(`Status updated to "${a}"!`);try{await Be(Ue(Re,"notifications"),{orderId:l.order_id,customerName:l.customer_name,newStatus:a,message:`Order #${l.order_id} for ${l.customer_name} has been updated to "${a}".`,timestamp:Ve(),read:!1,updatedBy:u})}catch(p){console.error("Error adding notification to Firestore:",p),P.error("Failed to create live notification.")}const o=`Updated status of Order #${l.order_id} to "${a}"`;await Ae(o,u),i(),_(!1),d()};return e.jsx(J,{isOpen:n,onClose:d,title:`Update Status for Order #${l.order_id}`,children:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Select the new status for this order. This will notify relevant parties."}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:ps.map(({name:u,icon:s})=>e.jsxs("button",{onClick:()=>b(u),className:`relative p-4 text-left rounded-lg border-2 transition-all transform hover:scale-105 ${a===u?"border-primary-500 bg-primary-50 dark:bg-primary-900/50 shadow-lg":"border-gray-200 dark:border-gray-600 hover:border-primary-400"}`,children:[a===u&&e.jsx(pe,{className:"w-5 h-5 text-primary-500 absolute top-2 right-2"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s,{className:`w-6 h-6 ${a===u?"text-primary-600":"text-gray-500"}`}),e.jsx("p",{className:`font-semibold ${a===u?"text-primary-700 dark:text-primary-200":"text-gray-800 dark:text-gray-100"}`,children:u})]})]},u))}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(j,{variant:"outline",onClick:d,disabled:h,children:"Cancel"}),e.jsxs(j,{onClick:v,disabled:h||a===l.status,children:[h&&e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}),"Update Status"]})]})]})})},fs={Pending:e.jsx(ae,{className:"w-5 h-5 text-yellow-500"}),Design:e.jsx(he,{className:"w-5 h-5 text-blue-500"}),Printing:e.jsx(ge,{className:"w-5 h-5 text-purple-500"}),Delivered:e.jsx(pe,{className:"w-5 h-5 text-green-500"})},js=({isOpen:l,onClose:n,orderId:d})=>{const[i,a]=r.useState(null),[b,h]=r.useState([]),[_,c]=r.useState(!0),[v,u]=r.useState(null);r.useEffect(()=>{l&&d&&s()},[l,d]);const s=async()=>{var o,p,F,x;c(!0),u(null);try{const{data:m,error:z}=await N.from("orders").select("*, customers (name, phone, email, address)").eq("id",d).single();if(z)throw z;const{data:E,error:M}=await N.from("order_status_log").select("*").eq("order_id",d).order("updated_at",{ascending:!1});if(M)throw M;const{data:V,error:C}=m.designer_id?await N.from("employees").select("name").eq("id",m.designer_id).single():{data:null,error:null};C&&console.warn("Could not fetch designer name:",C.message),a({...m,order_id:m.id,customer_name:((o=m.customers)==null?void 0:o.name)||m.customer_name,customer_phone:((p=m.customers)==null?void 0:p.phone)||m.customer_phone,customer_email:(F=m.customers)==null?void 0:F.email,customer_address:(x=m.customers)==null?void 0:x.address,designer_name:V==null?void 0:V.name}),h(E||[])}catch(m){u(m.message||"Failed to fetch order details")}finally{c(!1)}};return l?e.jsx(J,{isOpen:l,onClose:n,title:`Order Details #${d}`,size:"3xl",children:_?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Y,{className:"w-8 h-8 animate-spin text-primary-500"})}):v?e.jsxs("div",{className:"text-center h-64 flex flex-col justify-center items-center text-red-600",children:[e.jsx("p",{className:"font-semibold",children:"Error loading order details"}),e.jsx("p",{className:"text-sm",children:v})]}):i?e.jsxs("div",{className:"space-y-6 max-h-[75vh] overflow-y-auto p-1 pr-4",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 dark:text-white mb-3",children:"Order Status"}),e.jsx($,{className:"p-4",children:e.jsx(xe,{currentStatus:i.status})})]}),e.jsxs("section",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-800 dark:text-white flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary-500"})," Customer"]}),e.jsxs($,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:i.customer_name})]}),i.customer_phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:i.customer_phone})]}),i.customer_address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(es,{className:"w-4 h-4 text-gray-400 mt-0.5"}),e.jsx("span",{children:i.customer_address})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-800 dark:text-white flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-primary-500"})," Order"]}),e.jsxs($,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:[i.order_type," (Qty: ",i.quantity,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["Ordered: ",new Date(i.date).toLocaleDateString("en-GB")]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["Delivery: ",new Date(i.delivery_date).toLocaleDateString("en-GB")]})]}),i.design_needed&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["Designer: ",i.designer_name||"Not Assigned"]})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-800 dark:text-white flex items-center gap-2 mb-3",children:[e.jsx(qe,{className:"w-5 h-5 text-primary-500"})," Financials"]}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total"}),e.jsxs("p",{className:"font-bold text-xl",children:["₹",(i.total_amount||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Paid"}),e.jsxs("p",{className:"font-bold text-xl text-green-600",children:["₹",(i.amount_received||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Balance"}),e.jsxs("p",{className:`font-bold text-xl ${i.balance_amount>0?"text-red-600":"text-green-600"}`,children:["₹",(i.balance_amount||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Method"}),e.jsx("p",{className:"font-bold text-lg",children:i.payment_method||"N/A"})]})]})})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"font-semibold text-lg text-gray-800 dark:text-white flex items-center gap-2 mb-3",children:[e.jsx(me,{className:"w-5 h-5 text-primary-500"})," History"]}),e.jsx($,{className:"p-4",children:b.length>0?e.jsxs("div",{className:"relative space-y-4",children:[e.jsx("div",{className:"absolute left-4 top-2 bottom-2 w-0.5 bg-gray-200 dark:bg-gray-700"}),b.map(o=>e.jsxs("div",{className:"relative flex items-start gap-4 pl-10",children:[e.jsx("div",{className:"absolute left-0 top-1.5 w-8 h-8 flex items-center justify-center bg-gray-100 dark:bg-gray-600 rounded-full ring-4 ring-white dark:ring-gray-800",children:fs[o.status]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o.status}),e.jsxs("p",{className:"text-xs text-gray-500",children:["by ",o.updated_by," on ",new Date(o.updated_at).toLocaleString("en-GB")]})]})]},o.id))]}):e.jsx("p",{className:"text-sm text-center text-gray-500 py-4",children:"No status history found."})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(j,{variant:"outline",onClick:n,children:"Close"}),e.jsx(j,{onClick:()=>window.open(`/invoices/${d}`,"_blank"),children:"View Full Invoice"})]})]}):null}):null},bs=({isOpen:l,onClose:n,order:d,onOrderUpdated:i})=>{const[a,b]=r.useState({customer_name:"",customer_phone:"",order_type:"",quantity:1,delivery_date:"",notes:"",designer_id:null,design_needed:!1}),[h,_]=r.useState([]),[c,v]=r.useState(!1),[u,s]=r.useState(null);r.useEffect(()=>{l&&d&&o(),(async()=>{const{data:m}=await N.from("employees").select("id, name").eq("job_role","Designer").eq("is_active",!0);_(m||[])})()},[l,d]);const o=async()=>{if(d){v(!0);try{const{data:x,error:m}=await N.from("orders").select("*").eq("id",d.order_id).single();if(m)throw m;b({customer_name:x.customer_name||"",customer_phone:x.customer_phone||"",order_type:x.order_type||"",quantity:x.quantity||1,delivery_date:x.delivery_date||"",notes:x.notes||"",designer_id:x.designer_id||null,design_needed:x.design_needed||!1})}catch(x){s(x.message)}finally{v(!1)}}},p=x=>{const{id:m,value:z,type:E}=x.target;b(M=>({...M,[m]:E==="checkbox"?x.target.checked:E==="number"?parseInt(z)||0:z}))},F=async x=>{if(x.preventDefault(),!d)return;v(!0),s(null);const{error:m}=await N.from("orders").update({customer_name:a.customer_name,customer_phone:a.customer_phone,order_type:a.order_type,quantity:a.quantity,delivery_date:a.delivery_date,notes:a.notes,designer_id:a.designer_id,design_needed:a.design_needed,updated_at:new Date().toISOString()}).eq("id",d.order_id);m?(P.error(`Update failed: ${m.message}`),s(m.message)):(P.success("Order updated successfully!"),i(),n()),v(!1)};return!l||!d?null:e.jsx(J,{isOpen:l,onClose:n,title:`Edit Order #${d.order_id}`,size:"2xl",children:e.jsxs("form",{onSubmit:F,className:"space-y-6 pt-2",children:[u&&e.jsx("div",{className:"... error styling ...",children:u}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{icon:e.jsx(ee,{size:16}),id:"customer_name",label:"Customer Name *",value:a.customer_name,onChange:p,required:!0,disabled:c}),e.jsx(A,{icon:e.jsx(ze,{size:16}),id:"customer_phone",label:"Customer Phone",type:"tel",value:a.customer_phone,onChange:p,disabled:c})]}),e.jsxs("div",{className:"p-4 border-t border-b dark:border-gray-700 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(B,{icon:e.jsx(ce,{size:16}),id:"order_type",label:"Order Type *",value:a.order_type,onChange:p,options:[{value:"Business Cards",label:"Business Cards"},{value:"Invitation Cards",label:"Invitation Cards"},{value:"Posters",label:"Posters"}],required:!0,disabled:c}),e.jsx(A,{id:"quantity",label:"Quantity *",type:"number",min:"1",value:a.quantity,onChange:p,required:!0,disabled:c})]}),e.jsx(A,{icon:e.jsx(Z,{size:16}),id:"delivery_date",label:"Delivery Date *",type:"date",value:a.delivery_date,onChange:p,required:!0,disabled:c})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"design_needed",checked:a.design_needed,onChange:p,disabled:c,className:"... checkbox styling ..."}),e.jsx("label",{htmlFor:"design_needed",className:"font-medium",children:"Design Service Needed?"})]}),a.design_needed&&e.jsx(B,{icon:e.jsx($e,{size:16}),id:"designer_id",label:"Assign Designer",value:a.designer_id||"",onChange:p,options:h.map(x=>({value:x.id,label:x.name})),disabled:c||!a.design_needed,placeholder:"Select Designer"})]}),e.jsx(Ie,{id:"notes",label:"Notes",value:a.notes,onChange:p,disabled:c,rows:3}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(j,{type:"button",variant:"outline",onClick:n,disabled:c,children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",disabled:c,children:c?e.jsx(Y,{className:"w-5 h-5 animate-spin"}):"Update Order"})]})]})})},vs=({isOpen:l,onClose:n,order:d,onOrderDeleted:i})=>{const[a,b]=r.useState(!1),[h,_]=r.useState("soft"),c=async()=>{if(d){b(!0);try{h==="soft"?(await N.from("orders").update({is_deleted:!0,deleted_at:new Date().toISOString()}).eq("id",d.order_id),await N.from("order_status_log").insert({order_id:d.order_id,status:"Cancelled",updated_by:"System",notes:"Order soft deleted"}),P.success("Order archived successfully!")):(await N.from("payments").delete().eq("order_id",d.order_id),await N.from("order_status_log").delete().eq("order_id",d.order_id),await N.from("orders").delete().eq("id",d.order_id),P.success("Order permanently deleted!")),i(),n()}catch(v){P.error(`Delete failed: ${v.message}`)}finally{b(!1)}}};return!l||!d?null:e.jsx(J,{isOpen:l,onClose:n,title:"Confirm Deletion",size:"lg",children:e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Pe,{className:"w-12 h-12 mx-auto text-red-500"}),e.jsxs("h3",{className:"text-xl font-bold mt-2",children:["Delete Order #",d.order_id,"?"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action requires careful consideration."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{onClick:()=>_("soft"),className:`p-4 border-2 rounded-lg cursor-pointer transition-all flex items-start gap-4 ${h==="soft"?"border-primary-500 bg-primary-50 dark:bg-primary-900/50":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(ls,{className:"w-8 h-8 text-primary-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Archive (Soft Delete)"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Hides the order from the main list but keeps it for records. This is reversible and recommended."})]})]}),e.jsxs("div",{onClick:()=>_("hard"),className:`p-4 border-2 rounded-lg cursor-pointer transition-all flex items-start gap-4 ${h==="hard"?"border-red-500 bg-red-50 dark:bg-red-900/50":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(se,{className:"w-8 h-8 text-red-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-800 dark:text-red-200",children:"Delete Permanently"}),e.jsx("p",{className:"text-xs text-red-700 dark:text-red-300",children:"Removes the order and all associated data forever. This action cannot be undone."})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(j,{variant:"outline",onClick:n,disabled:a,children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:c,disabled:a,children:a?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):`Yes, ${h==="soft"?"Archive":"Delete Permanently"}`})]})]})})},Ns=({isOpen:l,onClose:n,selectedOrders:d,onBulkActionComplete:i})=>{const[a,b]=r.useState(""),[h,_]=r.useState(""),[c,v]=r.useState(!1),u=async()=>{if(!a||d.length===0)return;v(!0);const s=d.map(o=>o.order_id);try{if(a==="status"&&h){const o=s.map(p=>N.from("order_status_log").insert({order_id:p,status:h,updated_by:"Bulk Action"}));await Promise.all(o),P.success(`Successfully updated status for ${s.length} orders.`)}else if(a==="delete"){await N.from("orders").update({is_deleted:!0,deleted_at:new Date().toISOString()}).in("id",s);const o=s.map(p=>N.from("order_status_log").insert({order_id:p,status:"Cancelled",updated_by:"Bulk Action",notes:"Bulk archived"}));await Promise.all(o),P.success(`Successfully archived ${s.length} orders.`)}i(),n()}catch(o){P.error(`Bulk action failed: ${o.message}`)}finally{v(!1)}};return l?e.jsx(J,{isOpen:l,onClose:n,title:"Bulk Order Actions",size:"lg",children:e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsx("div",{className:"p-3 bg-primary-50 dark:bg-primary-900/30 rounded-lg text-center",children:e.jsxs("p",{className:"font-semibold text-primary-800 dark:text-primary-200",children:[d.length," Orders Selected"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Choose an action to apply to all selected orders:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>b("status"),className:`p-4 border-2 rounded-lg cursor-pointer transition-all flex flex-col items-center justify-center text-center ${a==="status"?"border-primary-500 bg-primary-50 dark:bg-primary-900/50":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(ue,{className:"w-8 h-8 mb-2 text-primary-600"}),e.jsx("p",{className:"font-semibold",children:"Update Status"})]}),e.jsxs("div",{onClick:()=>b("delete"),className:`p-4 border-2 rounded-lg cursor-pointer transition-all flex flex-col items-center justify-center text-center ${a==="delete"?"border-red-500 bg-red-50 dark:bg-red-900/50":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx(se,{className:"w-8 h-8 mb-2 text-red-600"}),e.jsx("p",{className:"font-semibold",children:"Archive Orders"})]})]})]}),a==="status"&&e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg animate-slide-up",children:e.jsx(B,{id:"newStatus",label:"Select New Status",value:h,onChange:s=>_(s.target.value),options:[{value:"Pending",label:"Pending"},{value:"Design",label:"Design"},{value:"Printing",label:"Printing"},{value:"Delivered",label:"Delivered"}],required:!0,placeholder:"Select new status"})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(j,{variant:"outline",onClick:n,disabled:c,children:"Cancel"}),e.jsx(j,{variant:a==="delete"?"destructive":"primary",onClick:u,disabled:c||!a||a==="status"&&!h,children:c?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):"Apply Action"})]})]})}):null},_s=({highlightOrderId:l})=>{const[n,d]=r.useState([]),[i,a]=r.useState(!0),[b,h]=r.useState(null),_=Qe(),[c,v]=r.useState(null),[u,s]=r.useState(!1),[o,p]=r.useState(!1),[F,x]=r.useState(!1),[m,z]=r.useState(!1),[E,M]=r.useState(!1),[V,C]=r.useState(null),[Q,re]=r.useState(""),[G,de]=r.useState(""),[W,y]=r.useState(""),[f,q]=r.useState(!1),[D,X]=r.useState("order_id"),[L,ye]=r.useState("desc"),[U,K]=r.useState([]),[ie,fe]=r.useState(!1),H=r.useCallback(async()=>{a(!0),h(null);try{let t=N.from("orders").select(`
          id, customer_id, order_type, quantity, date, delivery_date, total_amount, 
          amount_received, balance_amount, is_deleted,
          customers!inner(name, phone)
        `);l?t=t.eq("id",l):(f||(t=t.or("is_deleted.is.null,is_deleted.eq.false")),t=t.order("id",{ascending:!1}));const{data:g,error:I}=await t;if(I)throw I;const w=(g==null?void 0:g.map(k=>k.id))||[],{data:O,error:R}=await N.from("order_status_log").select("order_id, status, updated_at").in("order_id",w).order("updated_at",{ascending:!1});if(R)throw R;const S={};O==null||O.forEach(k=>{k.order_id&&!S[k.order_id]&&(S[k.order_id]=k.status)});const ne=(g==null?void 0:g.map(k=>{var we,ke;return{order_id:k.id,customer_name:((we=k.customers)==null?void 0:we.name)||"Unknown Customer",customer_phone:((ke=k.customers)==null?void 0:ke.phone)||void 0,order_type:k.order_type,quantity:k.quantity,date:k.date,delivery_date:k.delivery_date,total_amount:k.total_amount,amount_received:k.amount_received,balance_amount:k.balance_amount,is_deleted:k.is_deleted,status:S[k.id]||"Pending"}}))||[];d(ne)}catch(t){h(t.message||"Failed to fetch orders.")}finally{a(!1)}},[f,l]);r.useEffect(()=>{H()},[H]);const Ee=()=>{_("/orders",{replace:!0})},Te=t=>{D===t?ye(L==="asc"?"desc":"asc"):(X(t),ye("desc"))},je=t=>{K(g=>g.some(w=>w.order_id===t.order_id)?g.filter(w=>w.order_id!==t.order_id):[...g,t])},Fe=()=>{K(ie?[]:T),fe(!ie)},T=r.useMemo(()=>{if(l&&n.length>0)return n;let t=n.filter(g=>{var R,S;const I=((R=g.customer_name)==null?void 0:R.toLowerCase().includes(Q.toLowerCase()))||((S=g.order_type)==null?void 0:S.toLowerCase().includes(Q.toLowerCase()))||String(g.order_id).includes(Q),w=!G||g.status===G,O=!W||g.date.startsWith(W);return I&&w&&O});return t.sort((g,I)=>{let w=g[D],O=I[D];return D==="date"||D==="delivery_date"?(w=new Date(w).getTime(),O=new Date(O).getTime()):typeof w=="string"&&(w=w.toLowerCase(),O=O.toLowerCase()),L==="asc"?w>O?1:-1:w<O?1:-1}),t},[n,Q,G,W,D,L,l]);r.useEffect(()=>{fe(T.length>0&&U.length===T.length)},[U,T]);const be=t=>{v(t),s(!0)},ve=t=>{C(t),p(!0)},Ne=t=>{v(t),x(!0)},_e=t=>{v(t),z(!0)},Me=()=>{const t=["Order ID","Customer","Order Type","Quantity","Order Date","Delivery Date","Status","Total Amount"],g=T.map(S=>[S.order_id,S.customer_name,S.order_type,S.quantity,new Date(S.date).toLocaleDateString(),new Date(S.delivery_date).toLocaleDateString(),S.status,S.total_amount?`₹${S.total_amount}`:"N/A"]),I=[t,...g].map(S=>S.map(ne=>`"${String(ne).replace(/"/g,'""')}"`).join(",")).join(`
`),w=new Blob([I],{type:"text/csv;charset=utf-8;"}),O=window.URL.createObjectURL(w),R=document.createElement("a");R.href=O,R.download=`orders-${new Date().toISOString().split("T")[0]}.csv`,R.click(),window.URL.revokeObjectURL(O)},le=({field:t,children:g})=>e.jsxs("button",{onClick:()=>Te(t),className:"flex items-center gap-1 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[g,e.jsx(as,{size:14,className:D===t?"text-primary-600 dark:text-primary-400":"text-gray-400"})]});return i?e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(Y,{className:"w-8 h-8 animate-spin text-primary-500"})}):b?e.jsxs($,{className:"p-6 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 text-center",children:[e.jsx(Pe,{className:"w-10 h-10 mx-auto mb-2 text-red-500"}),e.jsx("p",{className:"font-semibold",children:"Error Loading Orders"}),e.jsx("p",{className:"text-sm",children:b})]}):e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["All Orders (",n.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(j,{onClick:H,variant:"outline",size:"sm",children:[e.jsx(He,{className:"w-4 h-4 mr-1"}),"Refresh"]}),e.jsxs(j,{onClick:Me,variant:"outline",size:"sm",children:[e.jsx(ss,{className:"w-4 h-4 mr-1"}),"Export CSV"]}),U.length>0&&e.jsxs(j,{onClick:()=>M(!0),variant:"primary",size:"sm",children:["Bulk Actions (",U.length,")"]})]})]}),l?e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/30 border border-primary-200 dark:border-primary-700 text-primary-800 dark:text-primary-200 p-3 rounded-lg flex justify-between items-center",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Showing details for highlighted Order #",l,"."]}),e.jsxs(j,{onClick:Ee,variant:"ghost",size:"sm",className:"flex items-center gap-1",children:[e.jsx(Ye,{size:16})," Clear"]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"relative md:col-span-2",children:[e.jsx(ts,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 absolute top-1/2 left-3 -translate-y-1/2"}),e.jsx(A,{id:"search",placeholder:"Search by Order ID, Customer, or Type...",value:Q,onChange:t=>re(t.target.value),className:"pl-10"})]}),e.jsx(B,{label:"Status",id:"statusFilter",value:G,onChange:t=>de(t.target.value),options:[{value:"",label:"All Statuses"},{value:"Pending",label:"Pending"},{value:"Design",label:"Design"},{value:"Printing",label:"Printing"},{value:"Delivered",label:"Delivered"}]}),e.jsx(A,{id:"dateFilter",type:"month",value:W,onChange:t=>y(t.target.value)}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("label",{htmlFor:"showDeleted",className:"text-sm",children:"Show Deleted"}),e.jsx("input",{type:"checkbox",id:"showDeleted",checked:f,onChange:t=>q(t.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"})]})]})]}),e.jsx("div",{className:"md:hidden p-4 space-y-4",children:T.length>0?T.map(t=>{var I;const g={Pending:"border-yellow-500",Design:"border-blue-500",Printing:"border-purple-500",Delivered:"border-green-500"};return e.jsxs("div",{className:`p-4 rounded-lg shadow-sm border-l-4 ${g[t.status]||"border-gray-400"} ${t.is_deleted?"bg-red-50 dark:bg-red-900/20":"bg-white dark:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:U.some(w=>w.order_id===t.order_id),onChange:()=>je(t),className:"mt-1"}),e.jsxs("div",{children:[e.jsxs(Se,{to:`/invoices/${t.order_id}`,className:"font-bold text-lg text-primary-600 hover:underline",children:["#",t.order_id]}),e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:t.customer_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.order_type," • Qty: ",t.quantity]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>ve(t.order_id),children:e.jsx(Ce,{size:16})}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>Ne(t),children:e.jsx(ue,{size:16})}),e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>_e(t),children:e.jsx(se,{size:16,className:"text-red-500"})})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx(xe,{currentStatus:t.status})}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500 pt-3 border-t dark:border-gray-700",children:[e.jsxs("span",{children:["Due: ",e.jsxs("span",{className:"font-bold text-red-500",children:["₹",(I=t.balance_amount)==null?void 0:I.toLocaleString()]})]}),t.customer_phone&&e.jsxs("a",{href:`https://wa.me/91${t.customer_phone}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-green-600 hover:underline",children:[e.jsx(Ge,{size:14})," WhatsApp"]}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>be(t),children:"Update"})]})]},t.order_id)}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(De,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{children:"No orders found for the current filters."})]})}),e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:ie,onChange:Fe,className:"rounded"})}),e.jsx("th",{className:"px-4 py-3",children:e.jsx(le,{field:"order_id",children:"Order"})}),e.jsx("th",{className:"px-4 py-3",children:e.jsx(le,{field:"customer_name",children:"Customer"})}),e.jsx("th",{className:"px-4 py-3",children:"Details"}),e.jsx("th",{className:"px-4 py-3",children:e.jsx(le,{field:"date",children:"Dates"})}),e.jsx("th",{className:"px-4 py-3 w-72",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:T.length>0?T.map(t=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors ${t.is_deleted?"opacity-50 bg-red-50/50 dark:bg-red-900/20":""} ${U.some(g=>g.order_id===t.order_id)?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:U.some(g=>g.order_id===t.order_id),onChange:()=>je(t),className:"rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs(Se,{to:`/invoices/${t.order_id}`,className:"font-semibold text-primary-600 hover:underline",children:["#",t.order_id]})}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:t.customer_name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customer_phone})]}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("div",{className:"font-medium",children:t.order_type}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty: ",t.quantity]})]}),e.jsx("td",{className:"px-4 py-2 text-xs text-gray-500",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{size:12}),"Order: ",new Date(t.date).toLocaleDateString("en-GB")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{size:12}),"Delivery: ",new Date(t.delivery_date).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(xe,{currentStatus:t.status})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-0.5",children:[e.jsx(j,{size:"icon",variant:"ghost",onClick:()=>ve(t.order_id),title:"View Details",children:e.jsx(Ce,{size:16})}),e.jsx(j,{size:"icon",variant:"ghost",onClick:()=>Ne(t),title:"Edit Order",children:e.jsx(ue,{size:16})}),e.jsx(j,{size:"icon",variant:"ghost",onClick:()=>be(t),title:"Update Status",children:e.jsx(os,{size:16})}),e.jsx(j,{size:"icon",variant:"ghost",onClick:()=>_e(t),title:"Delete Order",children:e.jsx(se,{size:16,className:"text-red-500"})})]})})]},t.order_id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-16 text-gray-500",children:[e.jsx(De,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No Orders Found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters."})]})})})]})}),T.length>0&&e.jsx("div",{className:"px-4 py-3 border-t dark:border-gray-700",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["Showing ",U.length," selected of ",T.length," orders."]})})]}),u&&c&&e.jsx(ys,{order:c,isOpen:u,onClose:()=>s(!1),onStatusUpdated:()=>{H(),s(!1)}}),o&&V&&e.jsx(js,{isOpen:o,onClose:()=>p(!1),orderId:V}),F&&c&&e.jsx(bs,{isOpen:F,onClose:()=>x(!1),order:c,onOrderUpdated:()=>{H(),x(!1)}}),m&&c&&e.jsx(vs,{isOpen:m,onClose:()=>z(!1),order:c,onOrderDeleted:()=>{H(),z(!1)}}),E&&e.jsx(Ns,{isOpen:E,onClose:()=>M(!1),selectedOrders:U,onBulkActionComplete:()=>{H(),K([]),M(!1)}})]})},Ks=()=>{const[l,n]=r.useState("manage"),[d]=We(),i=d.get("highlight");return r.useEffect(()=>{i&&n("manage")},[i]),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Orders Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Create, view, and manage all your customer orders."})]})}),e.jsxs("div",{className:"flex space-x-2 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>n("manage"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors -mb-px rounded-t-lg ${l==="manage"?"bg-white dark:bg-gray-800 border border-b-0 border-gray-200 dark:border-gray-700 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(rs,{size:16}),"Manage Orders"]}),e.jsxs("button",{onClick:()=>n("add"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors -mb-px rounded-t-lg ${l==="add"?"bg-white dark:bg-gray-800 border border-b-0 border-gray-200 dark:border-gray-700 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(ds,{size:16}),"Add New Order"]})]}),e.jsxs("div",{className:"mt-0",children:[" ",l==="manage"?e.jsx(_s,{highlightOrderId:i}):e.jsx("div",{className:"max-w-3xl mx-auto bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm",children:e.jsx(gs,{onSuccess:()=>n("manage")})})]})]})};export{Ks as default};
